/*
 * oled.c
 *
 *  Created on: Feb 25, 2024
 *      Author: login
 */


#include "oled.h"

void oled_data_out(uint8_t data)
{
    GPIOC->ODR = (GPIOC->ODR & 0XFF00) | (data & 0X00FF);
}


void oled_wr_byte(uint8_t data, uint8_t cmd)
{
	OLED_RS (cmd);			/* 数据类型，由传参决定 */
	OLED_CS ( 0 );			/* 拉低片选线，选中SSD1306 */
	OLED_WR ( 0 );			/* 拉低WR线，准备数据 */
	oled_data_out(data); 	/* WR低电平期间，准备数据 */
	OLED_WR ( 1 );			/* 在WR上升沿，数据发出 */
	OLED_CS ( 1 );			/* 取消片选 */
	OLED_RS ( 1 );			/* 释放RS线，恢复默认 */
}

void oled_test(void)
{
	/* 第0页的第0列 */
	oled_wr_byte(0xB0, OLED_CMD);
	oled_wr_byte(0x00, OLED_CMD);
	oled_wr_byte(0x10, OLED_CMD);
	for(uint8_t i = 0; i< 128 ; i++)
	oled_wr_byte(0x0, OLED_DATA);
}

void oled_init(void)
{
	oled_wr_byte(0xAE, OLED_CMD);   /* 关闭显示 */
	oled_wr_byte(0xD5, OLED_CMD);   /* 设置时钟分频因子,震荡频率 */
	oled_wr_byte(80, OLED_CMD);     /* [3:0],分频因子;[7:4],震荡频率 */
	oled_wr_byte(0xA8, OLED_CMD);   /* 设置驱动路数 */
	oled_wr_byte(0X3F, OLED_CMD);   /* 默认0X3F(1/64) */
	oled_wr_byte(0xD3, OLED_CMD);   /* 设置显示偏移 */
	oled_wr_byte(0X00, OLED_CMD);   /* 默认为0 */

	oled_wr_byte(0x40, OLED_CMD);   /* 设置显示开始行 [5:0],行数. */

	oled_wr_byte(0x8D, OLED_CMD);   /* 电荷泵设置 */
	oled_wr_byte(0x14, OLED_CMD);   /* bit2，开启/关闭 */
	oled_wr_byte(0x20, OLED_CMD);   /* 设置内存地址模式 */
	oled_wr_byte(0x02, OLED_CMD);   /* [1:0],00，列地址模式;01，行地址模式;10,页地址模式;默认10; */
	oled_wr_byte(0xA1, OLED_CMD);   /* 段重定义设置,bit0:0,0->0;1,0->127; */
	oled_wr_byte(0xC8, OLED_CMD);   /* 设置COM扫描方向;bit3:0,普通模式;1,重定义模式 COM[N-1]->COM0;N:驱动路数 */
	oled_wr_byte(0xDA, OLED_CMD);   /* 设置COM硬件引脚配置 */
	oled_wr_byte(0x12, OLED_CMD);   /* [5:4]配置 */

	oled_wr_byte(0x81, OLED_CMD);   /* 对比度设置 */
	oled_wr_byte(0xEF, OLED_CMD);   /* 1~255;默认0X7F (亮度设置,越大越亮) */
	oled_wr_byte(0xD9, OLED_CMD);   /* 设置预充电周期 */
	oled_wr_byte(0xf1, OLED_CMD);   /* [3:0],PHASE 1;[7:4],PHASE 2; */
	oled_wr_byte(0xDB, OLED_CMD);   /* 设置VCOMH 电压倍率 */
	oled_wr_byte(0x30, OLED_CMD);   /* [6:4] 000,0.65*vcc;001,0.77*vcc;011,0.83*vcc; */

	oled_wr_byte(0xA4, OLED_CMD);   /* 全局显示开启;bit0:1,开启;0,关闭;(白屏/黑屏) */
	oled_wr_byte(0xA6, OLED_CMD);   /* 设置显示方式;bit0:1,反相显示;0,正常显示 */
	oled_wr_byte(0xAF, OLED_CMD);   /* 开启显示 */
}
