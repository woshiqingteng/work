# 实战_SVC异常

要想深入理解异常处理，需要写程序来验证。
本节课程故意执行一条SVC指令，让它触发异常。

参考资料：`ARM Cortex-M3与Cortex-M4权威指南.pdf`、`DDI0403E_B_armv7m_arm.pdf`、`PM0056.pdf`

## 1.1 M3_M4支持哪些异常

从向量表可以看出，M3/M4支持哪些异常：

```
__Vectors       DCD     __initial_sp               ; Top of Stack
                DCD     Reset_Handler              ; Reset Handler
                DCD     NMI_Handler                ; NMI Handler
                DCD     HardFault_Handler          ; Hard Fault Handler
                DCD     MemManage_Handler          ; MPU Fault Handler
                DCD     BusFault_Handler           ; Bus Fault Handler
                DCD     UsageFault_Handler         ; Usage Fault Handler
                DCD     0                          ; Reserved
                DCD     0                          ; Reserved
                DCD     0                          ; Reserved
                DCD     0                          ; Reserved
                DCD     SVC_Handler                ; SVCall Handler
                DCD     DebugMon_Handler           ; Debug Monitor Handler
                DCD     0                          ; Reserved
                DCD     PendSV_Handler             ; PendSV Handler
                DCD     SysTick_Handler            ; SysTick Handler
                
                ; External Interrupts
                DCD     WWDG_IRQHandler            ; Window Watchdog
                DCD     PVD_IRQHandler             ; PVD through EXTI Line detect   
```



在上述代码中，可以看到`SVC_Handler`，它对应SVC异常，当执行`SVC`指令时，会导致`SVC_Handler`被调用。



## 1.2 什么是SVC指令？

在ARM指令中，有一条指令：

```
SVC #VAL
```

它会触发一个异常。
在操作系统中，比如各类RTOS或者Linux，都会使用`SVC`指令故意触发异常，从而导致内核的异常处理函数被调用，进而去使用内核的服务。
比如Linux中，各类文件操作的函数`open`、`read`、`write`，它的实质都是`SVC`指令。
本节课程不讲解`SVC`在内核中的使用，我们只是看看如何处理`SVC`触发的异常。



## 1.3 在汇编代码里插入SVC指令

在代码中插入：

```
SVC #1
```

看看会发生什么事情。

 

### 1.3.1 提供SVC异常处理函数



### 1.3.2 查看保存的现场
